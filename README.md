# Project Citadel - Terraform Challenge

## Overview

This project demonstrates the implementation of an EC2 instance on AWS using **Terraform**. The EC2 instance is configured with a **user_data** script to automatically install and start **Nginx** on the instance. The instance is created with a **public IP** (Elastic IP), and the **public DNS** is saved to a file using a **local-exec provisioner**.

---

## Requirements

1. **Terraform** installed on your system (preferably version 1.5.0 or higher).
2. **AWS CLI** configured for interacting with AWS or **LocalStack** (if using a local AWS simulation).
3. **Key Pair** to be used with the EC2 instance.
4. **LocalStack** (optional): For testing resources locally (if you're not using a real AWS account).
5. The project assumes the following files are in place:
   - A public key for SSH access (`ec2-connect-key.pub`).
   - A script (`install-nginx.sh`) to install **Nginx** on the EC2 instance.

---

## Architecture

### **Infrastructure Overview**

- **AWS EC2 Instance**:
  - Instance is based on the **AMI ID** `ami-06178cf087598769c`.
  - Instance type: `m5.large`.
  - **User Data Script**: Installs **Nginx** on the EC2 instance when it starts up.
- **Key Pair**:

  - **Key Name**: `citadel`
  - Public key (`ec2-connect-key.pub`) is used to create the key pair.

- **Elastic IP (EIP)**:
  - Elastic IP is associated with the EC2 instance for public access.
  - **Provisioner** (`local-exec`) is used to write the **public DNS** of the EC2 instance to a file (`citadel_public_dns.txt`).

---

## File Breakdown

### **1. `main.tf`**

This is the main Terraform configuration file that defines the AWS resources.

- **AWS Key Pair** (`aws_key_pair`):
  - Creates an EC2 key pair named `citadel` using a public key (`ec2-connect-key.pub`).
- **EC2 Instance** (`aws_instance`):

  - Configures an EC2 instance using the provided **AMI**, **instance type**, and **key pair**.
  - A **user_data** script is provided to install and start **Nginx** on the instance upon creation.

- **Elastic IP** (`aws_eip`):
  - An Elastic IP is allocated and associated with the EC2 instance.
  - A **local-exec provisioner** is used to write the **public DNS** of the instance to a file (`/root/citadel_public_dns.txt`).

### **2. `provider.tf`**

This file configures the **AWS provider** in Terraform. It sets the region and provides endpoints for LocalStack (if using a local AWS simulator).

### **3. `variables.tf`**

Contains all the variables required for the Terraform configuration:

- **AMI ID**: The AMI ID used to create the EC2 instance.
- **Region**: AWS region (set to `eu-west-2`).
- **Instance Type**: Type of EC2 instance (set to `m5.large`).

### **4. `outputs.tf`**

Defines the outputs that will be displayed after Terraform is applied:

- **Instance ID**: The ID of the EC2 instance.
- **Public DNS**: The public DNS of the EC2 instance.

### **5. `install-nginx.sh`**

A simple shell script used in the **user_data** argument to install and start **Nginx** on the EC2 instance.

```bash
#!/bin/bash
sudo yum update -y
sudo yum install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

## Steps to Deploy the Infrastructure

### **1. Install Terraform**

If you don't have Terraform installed, you can download it from [Terraform's official site](https://www.terraform.io/downloads.html).

### **2. Set Up AWS CLI (Optional for LocalStack)**

If you're using **LocalStack** to simulate AWS locally, ensure that the AWS CLI is installed and configured with dummy credentials:

```bash
aws configure
# Set dummy values for access keys and region for LocalStack
```

### **3. Initialize Terraform**

Navigate to your project directory and initialize Terraform:

```bash
terraform init
```

This command downloads the necessary provider plugins and initializes the working directory.

### **4. Apply Terraform Configuration**

Run the following command to apply the Terraform configuration:

```bash
terraform apply
```

Terraform will show you the resources that it plans to create. Confirm by typing `yes` when prompted.

### **5. Verify the Resources**

Once the apply process is completed:

- Check the **public DNS** of the EC2 instance in the output.
- SSH into the instance using the private key associated with `citadel-key` (use `ec2-connect-key.pem`).

To view the public DNS of the EC2 instance, you can read the file `/root/citadel_public_dns.txt` generated by the provisioner.

### **6. Clean Up (Optional)**

To destroy the resources you’ve created, run:

```bash
terraform destroy
```

Confirm the action by typing `yes`.

---

## What's Happening Behind the Scenes

- **AWS EC2 Instance Creation**: Terraform provisions an EC2 instance based on the provided **AMI** and **instance type**.
- **User Data Execution**: On instance boot, the `user_data` script is executed to install and start **Nginx**.
- **Elastic IP**: An Elastic IP is associated with the instance for consistent access.
- **Provisioners**: A `local-exec` provisioner is used to write the EC2 instance’s **public DNS** to a file.

---

## Conclusion

In this challenge, you have successfully set up an EC2 instance with a user_data script to automatically install **Nginx**. You also managed Elastic IP allocation and utilized Terraform provisioners to save the instance's public DNS to a file. This challenge showcases the ability to manage cloud infrastructure with **Infrastructure as Code** (IaC) principles using **Terraform**.
